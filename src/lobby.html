<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Welcome, <span id="playerNameDisplay"></span>!</h1>
        <p>Select an option:</p>
        <button id="startNewGameBtn">Start New Game</button>
        <button id="viewOpenGamesBtn">View Open Games</button>
        <button id="viewTournamentsBtn">View Tournaments</button>
        <button id="createTournamentBtn">Create New Tournament</button>

        <div id="gameSelection" style="display: none;">
            <h3>Choose your move:</h3>
            <button class="moveBtn" id="rockBtn">Rock</button>
            <button class="moveBtn" id="paperBtn">Paper</button>
            <button class="moveBtn" id="scissorsBtn">Scissors</button>
        </div>

        <div id="gameResult" style="display: none;">
            <h3>Game Result:</h3>
            <p id="resultText"></p>
        </div>

        <div id="tournamentDetails" style="display: none;">
            <h3>Tournaments and Rounds</h3>
        </div>

        <div id="aiSelection" style="display: none;">
            <h3>Choose your move against the AI:</h3>
            <button class="aiMoveBtn" id="aiRockBtn">Rock</button>
            <button class="aiMoveBtn" id="aiPaperBtn">Paper</button>
            <button class="aiMoveBtn" id="aiScissorsBtn">Scissors</button>
        </div>

        <div id="aiResult" style="display: none;">
            <h3>AI Game Result:</h3>
            <p id="aiResultText"></p>
        </div>

        <h3>Scoreboard:</h3>
        <table>
            <tr>
                <th>Your Wins</th>
                <th>AI Wins</th>
            </tr>
            <tr>
                <td id="playerWins">0</td>
                <td id="aiWins">0</td>
            </tr>
        </table>

        <p id="lobbyMessage"></p>
        <ul id="gamesList"></ul>
    </div>

    <script>
        // Retrieve player name from localStorage
        const playerName = localStorage.getItem("playerName");

        if (playerName) {
            document.getElementById('playerNameDisplay').innerText = playerName;
        } else {
            alert("Player name is missing.");
            window.location.href = "index.html";
        }

        // Start a new game
        document.getElementById('startNewGameBtn').addEventListener('click', startNewGame);

        function startNewGame() {
            if (!playerName) {
                alert("Please enter your name first.");
                return;
            }

            fetch('http://localhost:3000/api/players', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerName: playerName }),
            })
            .then(response => response.json())
            .then(data => {
                createNewGame(data.id);
            })
            .catch(error => console.error("Error creating player:", error));
        }

        function createNewGame(playerId) {
            fetch('http://localhost:3000/api/games', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerId: playerId }),
            })
            .then(response => response.json())
            .then(gameData => {
                document.getElementById('gameSelection').style.display = 'block';
                window.gameId = gameData.gameId;
            })
            .catch(error => alert("Error creating game:", error));
        }

        // Handle game moves
        document.querySelectorAll('.moveBtn').forEach(button => {
            button.addEventListener('click', function () {
                const playerMove = this.id.replace('Btn', '').toLowerCase();
                playGame(window.gameId, playerMove);
            });
        });

        function playGame(gameId, playerMove) {
            fetch(`http://localhost:3000/api/games/${gameId}/play`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerMove: playerMove }),
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('gameSelection').style.display = 'none';
                document.getElementById('gameResult').style.display = 'block';
                document.getElementById('resultText').innerText = `You chose ${data.playerMove}. AI chose ${data.computerMove}. Result: ${data.result}`;
            })
            .catch(error => console.error("Error playing game:", error));
        }
    </script>
</body>
</html>
